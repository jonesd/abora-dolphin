"Filed out from Dolphin Smalltalk 2002 release 5.00"!

RuntimeSessionManager subclass: #BeAboraSessionManager
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	classInstanceVariableNames: ''!
BeAboraSessionManager guid: (GUID fromString: '{9B1A10D0-110C-4705-9F71-757092A30861}')!
BeAboraSessionManager comment: ''!
!BeAboraSessionManager categoriesForClass!System-Support! !
!BeAboraSessionManager methodsFor!

defaultResLibPath
        ^self argv first!

main
	"Start up the Dolphin Calculator sample application"

	| dumper canLoad loadError shell |
	self requiredClasses.
	dumper := WorksStorageDumper new.
	canLoad := dumper doesWorksStorageFileExist.
	canLoad 
		ifTrue: [[dumper restoreWorksStorage] on: Error do: [:error | loadError := error]].
	shell := self mainShellClass show.
	shell saveOnClose: true.
	BeNetworkListener current: (BeNetworkListener port: BeNetworkListener defaultPort).
	BeNetworkListener current accept.
	canLoad 
		ifTrue: [loadError notNil ifTrue: [self warnCorruptWorksStorage: loadError]]
		ifFalse: [self warnMissingWorksStorage].
	^shell!

requiredClasses
	"Private - hack to ensure certain classes aren't removed during deployment"

	#todo.
	STBBeContentElementForBE!

warnCorruptWorksStorage: loadError
	MessageBox 
		notify: 'Unable to load existing Works Storage file, either it has become corrupt or was generated by an incompatible version of Abora.

[', loadError displayString,']'
		caption: AboraSystem current applicationName!

warnMissingWorksStorage
	MessageBox 
		notify: 'No existing Works Storage file could be found, so using default Works instead.

This version of Abora uses a very simple mechanism to save all works to a single file in one operation.
In the future this will be improved to an incremental process that wont burden the user.

There is **NO GUARANTEE** that future versions of Abora will be able to read this file.'
		caption: AboraSystem current applicationName! !
!BeAboraSessionManager categoriesFor: #defaultResLibPath!public! !
!BeAboraSessionManager categoriesFor: #main!public! !
!BeAboraSessionManager categoriesFor: #requiredClasses!private! !
!BeAboraSessionManager categoriesFor: #warnCorruptWorksStorage:!private! !
!BeAboraSessionManager categoriesFor: #warnMissingWorksStorage!private! !

!BeAboraSessionManager class methodsFor!

mainShellClass
	"Answer the class of the application's main window (a <Shell> presenter)."

	^BeShell! !
!BeAboraSessionManager class categoriesFor: #mainShellClass!public! !

